{"version":3,"sources":["../../src/preconditions/ClientPermissions.ts"],"names":[],"mappings":";;;;AAAA;AAAA,EAGC;AAAA,EACA;AAAA,OAKM;AACP,SAAS,mBAAmB;AAE5B,SAAS,4BAA4B;AAM9B,IAAM,oBAAN,cAA+B,qBAAqB;AAAA,EAApD;AAAA;AACN,SAAiB,uBAAuB,IAAI;AAAA,MAC3C,CAAC,IAAI,oBAAoB;AAAA;AAAA,QAExB,oBAAoB;AAAA,QACpB,oBAAoB;AAAA,QACpB,oBAAoB;AAAA,QACpB,oBAAoB;AAAA,QACpB,oBAAoB;AAAA,QACpB,oBAAoB;AAAA,QACpB,oBAAoB;AAAA,MACrB,CAAC,EAAE,WAAW,oBAAoB;AAAA,IACnC,EAAE,OAAO;AAAA;AAAA,EAEF,WAAW,SAAkB,GAAY,SAAqE;AACpH,UAAM,WAAW,QAAQ,eAAe,IAAI,oBAAoB;AAChE,UAAM,UAAU,QAAQ;AAExB,QAAI,CAAC,QAAQ,OAAO,IAAI;AACvB,aAAO,KAAK,MAAM;AAAA,QACjB,YAAY,YAAY;AAAA,QACxB,SAAS;AAAA,MACV,CAAC;AAAA,IACF;AAEA,UAAM,cAAc,QAAQ,QAAQ,QAAQ,eAAe,QAAQ,OAAO,EAAE,IAAI,KAAK;AAErF,WAAO,KAAK,UAAU,UAAU,aAAa,SAAS;AAAA,EACvD;AAAA,EAEA,MAAa,aACZ,aACA,GACA,SACmC;AACnC,UAAM,WAAW,QAAQ,eAAe,IAAI,oBAAoB;AAEhE,UAAM,UAAW,MAAM,KAAK,4BAA4B,WAAW;AAEnE,UAAM,cAAc,YAAY,QAAQ,IAAI,QAAQ,eAAe,YAAY,aAAa,IAAI,KAAK;AAErG,WAAO,KAAK,UAAU,UAAU,aAAa,YAAY;AAAA,EAC1D;AAAA,EAEA,MAAa,eACZ,aACA,GACA,SACmC;AACnC,UAAM,WAAW,QAAQ,eAAe,IAAI,oBAAoB;AAChE,UAAM,UAAW,MAAM,KAAK,4BAA4B,WAAW;AAEnE,UAAM,cAAc,YAAY,QAAQ,IAAI,QAAQ,eAAe,YAAY,aAAa,IAAI,KAAK;AAErG,WAAO,KAAK,UAAU,UAAU,aAAa,cAAc;AAAA,EAC5D;AAAA,EAEQ,UAAU,qBAA0C,sBAAkD,aAAqB;AAClI,QAAI,CAAC,sBAAsB;AAC1B,aAAO,KAAK,MAAM;AAAA,QACjB,YAAY,YAAY;AAAA,QACxB,SAAS,iDAAiD;AAAA,MAC3D,CAAC;AAAA,IACF;AAEA,UAAM,UAAU,qBAAqB,QAAQ,mBAAmB;AAChE,WAAO,QAAQ,WAAW,IACvB,KAAK,GAAG,IACR,KAAK,MAAM;AAAA,MACX,YAAY,YAAY;AAAA,MACxB,SAAS,+DAA+D,QACtE,IAAI,CAAC,SAAS,kBAAiB,oBAAoB,IAAI,CAAC,EACxD,KAAK,IAAI;AAAA,MACX,SAAS,EAAE,QAAQ;AAAA,IACnB,CAAC;AAAA,EACL;AA6CD;AAxHO,IAAM,mBAAN;AAAM;AAAA,iBA6EW,sBAAyD;AAAA,EAC/E,cAAc;AAAA,EACd,eAAe;AAAA,EACf,aAAa;AAAA,EACb,YAAY;AAAA,EACZ,gBAAgB;AAAA,EAChB,SAAS;AAAA,EACT,qBAAqB;AAAA,EACrB,sBAAsB;AAAA,EACtB,qBAAqB;AAAA,EACrB,eAAe;AAAA,EACf,YAAY;AAAA,EACZ,aAAa;AAAA,EACb,gBAAgB;AAAA,EAChB,yBAAyB;AAAA,EACzB,cAAc;AAAA,EACd,aAAa;AAAA,EACb,gBAAgB;AAAA,EAChB,iBAAiB;AAAA,EACjB,aAAa;AAAA,EACb,eAAe;AAAA,EACf,gBAAgB;AAAA,EAChB,iBAAiB;AAAA,EACjB,iBAAiB;AAAA,EACjB,aAAa;AAAA,EACb,aAAa;AAAA,EACb,iBAAiB;AAAA,EACjB,oBAAoB;AAAA,EACpB,gBAAgB;AAAA,EAChB,uBAAuB;AAAA,EACvB,cAAc;AAAA,EACd,iBAAiB;AAAA,EACjB,OAAO;AAAA,EACP,uBAAuB;AAAA,EACvB,QAAQ;AAAA,EACR,wBAAwB;AAAA,EACxB,mBAAmB;AAAA,EACnB,qBAAqB;AAAA,EACrB,QAAQ;AAAA,EACR,cAAc;AAAA,EACd,aAAa;AAAA,EACb,mBAAmB;AACpB","sourcesContent":["import {\n\tChatInputCommandInteraction,\n\tContextMenuCommandInteraction,\n\tPermissionFlagsBits,\n\tPermissionsBitField,\n\tPermissionsString,\n\ttype BaseGuildTextChannel,\n\ttype GuildTextBasedChannel,\n\ttype Message\n} from 'discord.js';\nimport { Identifiers } from '../lib/errors/Identifiers';\nimport type { Command } from '../lib/structures/Command';\nimport { AllFlowsPrecondition } from '../lib/structures/Precondition';\n\nexport interface PermissionPreconditionContext extends AllFlowsPrecondition.Context {\n\tpermissions?: PermissionsBitField;\n}\n\nexport class CorePrecondition extends AllFlowsPrecondition {\n\tprivate readonly dmChannelPermissions = new PermissionsBitField(\n\t\t~new PermissionsBitField([\n\t\t\t//\n\t\t\tPermissionFlagsBits.AddReactions,\n\t\t\tPermissionFlagsBits.AttachFiles,\n\t\t\tPermissionFlagsBits.EmbedLinks,\n\t\t\tPermissionFlagsBits.ReadMessageHistory,\n\t\t\tPermissionFlagsBits.SendMessages,\n\t\t\tPermissionFlagsBits.UseExternalEmojis,\n\t\t\tPermissionFlagsBits.ViewChannel\n\t\t]).bitfield & PermissionsBitField.All\n\t).freeze();\n\n\tpublic messageRun(message: Message, _: Command, context: PermissionPreconditionContext): AllFlowsPrecondition.Result {\n\t\tconst required = context.permissions ?? new PermissionsBitField();\n\t\tconst channel = message.channel as BaseGuildTextChannel;\n\n\t\tif (!message.client.id) {\n\t\t\treturn this.error({\n\t\t\t\tidentifier: Identifiers.PreconditionClientPermissionsNoClient,\n\t\t\t\tmessage: 'There was no client to validate the permissions for.'\n\t\t\t});\n\t\t}\n\n\t\tconst permissions = message.guild ? channel.permissionsFor(message.client.id) : this.dmChannelPermissions;\n\n\t\treturn this.sharedRun(required, permissions, 'message');\n\t}\n\n\tpublic async chatInputRun(\n\t\tinteraction: ChatInputCommandInteraction,\n\t\t_: Command,\n\t\tcontext: PermissionPreconditionContext\n\t): AllFlowsPrecondition.AsyncResult {\n\t\tconst required = context.permissions ?? new PermissionsBitField();\n\n\t\tconst channel = (await this.fetchChannelFromInteraction(interaction)) as GuildTextBasedChannel;\n\n\t\tconst permissions = interaction.inGuild() ? channel.permissionsFor(interaction.applicationId) : this.dmChannelPermissions;\n\n\t\treturn this.sharedRun(required, permissions, 'chat input');\n\t}\n\n\tpublic async contextMenuRun(\n\t\tinteraction: ContextMenuCommandInteraction,\n\t\t_: Command,\n\t\tcontext: PermissionPreconditionContext\n\t): AllFlowsPrecondition.AsyncResult {\n\t\tconst required = context.permissions ?? new PermissionsBitField();\n\t\tconst channel = (await this.fetchChannelFromInteraction(interaction)) as GuildTextBasedChannel;\n\n\t\tconst permissions = interaction.inGuild() ? channel.permissionsFor(interaction.applicationId) : this.dmChannelPermissions;\n\n\t\treturn this.sharedRun(required, permissions, 'context menu');\n\t}\n\n\tprivate sharedRun(requiredPermissions: PermissionsBitField, availablePermissions: PermissionsBitField | null, commandType: string) {\n\t\tif (!availablePermissions) {\n\t\t\treturn this.error({\n\t\t\t\tidentifier: Identifiers.PreconditionClientPermissionsNoPermissions,\n\t\t\t\tmessage: `I was unable to resolve my permissions in the ${commandType} command invocation channel.`\n\t\t\t});\n\t\t}\n\n\t\tconst missing = availablePermissions.missing(requiredPermissions);\n\t\treturn missing.length === 0\n\t\t\t? this.ok()\n\t\t\t: this.error({\n\t\t\t\t\tidentifier: Identifiers.PreconditionClientPermissions,\n\t\t\t\t\tmessage: `I am missing the following permissions to run this command: ${missing\n\t\t\t\t\t\t.map((perm) => CorePrecondition.readablePermissions[perm])\n\t\t\t\t\t\t.join(', ')}`,\n\t\t\t\t\tcontext: { missing }\n\t\t\t  });\n\t}\n\n\tpublic static readonly readablePermissions: Record<PermissionsString, string> = {\n\t\tAddReactions: 'Add Reactions',\n\t\tAdministrator: 'Administrator',\n\t\tAttachFiles: 'Attach Files',\n\t\tBanMembers: 'Ban Members',\n\t\tChangeNickname: 'Change Nickname',\n\t\tConnect: 'Connect',\n\t\tCreateInstantInvite: 'Create Instant Invite',\n\t\tCreatePrivateThreads: 'Create Private Threads',\n\t\tCreatePublicThreads: 'Create Public Threads',\n\t\tDeafenMembers: 'Deafen Members',\n\t\tEmbedLinks: 'Embed Links',\n\t\tKickMembers: 'Kick Members',\n\t\tManageChannels: 'Manage Channels',\n\t\tManageEmojisAndStickers: 'Manage Emojis and Stickers',\n\t\tManageEvents: 'Manage Events',\n\t\tManageGuild: 'Manage Server',\n\t\tManageMessages: 'Manage Messages',\n\t\tManageNicknames: 'Manage Nicknames',\n\t\tManageRoles: 'Manage Roles',\n\t\tManageThreads: 'Manage Threads',\n\t\tManageWebhooks: 'Manage Webhooks',\n\t\tMentionEveryone: 'Mention Everyone',\n\t\tModerateMembers: 'Moderate Members',\n\t\tMoveMembers: 'Move Members',\n\t\tMuteMembers: 'Mute Members',\n\t\tPrioritySpeaker: 'Priority Speaker',\n\t\tReadMessageHistory: 'Read Message History',\n\t\tRequestToSpeak: 'Request to Speak',\n\t\tSendMessagesInThreads: 'Send Messages in Threads',\n\t\tSendMessages: 'Send Messages',\n\t\tSendTTSMessages: 'Send TTS Messages',\n\t\tSpeak: 'Speak',\n\t\tUseEmbeddedActivities: 'Start Activities',\n\t\tStream: 'Stream',\n\t\tUseApplicationCommands: 'Use Application Commands',\n\t\tUseExternalEmojis: 'Use External Emojis',\n\t\tUseExternalStickers: 'Use External Stickers',\n\t\tUseVAD: 'Use Voice Activity',\n\t\tViewAuditLog: 'View Audit Log',\n\t\tViewChannel: 'Read Messages',\n\t\tViewGuildInsights: 'View Guild Insights'\n\t};\n}\n"]}